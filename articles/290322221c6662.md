---
title: "GitHub Actions ã§ Visual Studio ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰é…å¸ƒ"
emoji: "ğŸ”§"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["githubactions", "github", "visualstudio", "cpp"]
published: false
---

# æ¦‚è¦

Windows ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªã‚’ Visual Studio ã§ä½œã‚‹ã“ã¨ãŒã‚ã£ã¦ã€GitHub ã« Push ã™ã‚‹ãŸã³ã« ãƒ“ãƒ«ãƒ‰ã—ãŸãƒã‚¤ãƒŠãƒªãŒ Release ã«ä¸ŠãŒã‚‹ã‚ˆã†ã«ã—ãŸããªã‚Šã¾ã—ãŸï¼

# æ›¸ã„ã¦ã„ã

`.github/workflows/msbuild.yml`ã‚’ä½œæˆã—ã¾ã™ã€‚

Visual Studio ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ã«ã¯[`microsoft/setup-msbuild`](https://github.com/microsoft/setup-msbuild)ã¨ã„ã† GitHub Action ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»¥ä¸‹ãŒãƒ†ãƒ³ãƒ—ãƒ¬ã§ã™ã€‚GitHub â†’ Actions ã‹ã‚‰ MSBuild based project ã¨ã„ã† Workflow ã‚’é¸ã‚“ã ã®ã¨åŒã˜å†…å®¹ã§ã™ã€‚

```yml
name: MSBuild

on:
  push:
    branches: ["main"]

  pull_request:
    branches: ["main"]

env:
  SOLUTION_FILE_PATH: .

  BUILD_CONFIGURATION: Release

permissions:
  contents: read

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4

      - name: Add MSBuild to PATH
        uses: microsoft/setup-msbuild@v1.0.2

      - name: Restore NuGet packages
        working-directory: ${{env.GITHUB_WORKSPACE}}
        run: nuget restore ${{env.SOLUTION_FILE_PATH}}

      - name: Build
        working-directory: ${{env.GITHUB_WORKSPACE}}
        run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} ${{env.SOLUTION_FILE_PATH}}
```

ã“ã‚Œã§ã€`.\x64\Release`ã« exe ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### ãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹

[`softprops/action-gh-release`](https://github.com/softprops/action-gh-release) ã¨ã„ã† GitHub Action ã‚’ä½¿ã£ã¦ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆã§ãã¾ã™ã€‚

steps ã®æœ«å°¾ã«æ–°ãŸã«è¿½åŠ ã—ã¾ã™ã€‚

```diff yml
  steps:
    ...
+   - name: Rename
+     run: mv .\x64\Release\*.exe ${{github.event.repository.name}}-${{github.ref_name}}.exe
+
+   - name: Release
+     uses: softprops/action-gh-release@v2
+     with:
+       files: ${{github.event.repository.name}}-${{github.ref_name}}.exe
```

å…ˆã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’`reponame-v1.0.0.exe`ã®ã‚ˆã†ãªå½¢ã«å¤‰æ›´ã—ã¦ãŠãã€`with: files: ãƒ•ã‚¡ã‚¤ãƒ«å`ã¨ã™ã‚‹ã“ã¨ã§ãƒªãƒªãƒ¼ã‚¹ã® Assets ã«æ–°ãŸã« exe ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚

### ã„ã‚ã„ã‚èª¿æ•´ã™ã‚‹

ãƒªãƒªãƒ¼ã‚¹ã«ã¯ã‚¿ã‚°ãŒå¿…é ˆã¨ã®ã“ã¨ã§ã€ã‚¿ã‚°ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ãƒ—ãƒƒã‚·ãƒ¥ã®ã¿ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff yml
  on:
    push:
      branches: ["main"]
+     tags:
+       - "v*.*.*"

  pull_request:
      branches: ["main"]
+     tags:
+       - "v*.*.*"
```

mv ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãè¾¼ã¿ã‚’è¡Œã†ã®ã§ã€permissions ã§æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

```diff yml
  permissions:
-   contents: read
+   contents: write
```

æœ€çµ‚çš„ã«ã¯ã“ã†ãªã‚Šã¾ã™ã€‚

```yml
name: MSBuild

on:
  push:
    branches: ["main"]
    tags:
      - "v*.*.*"

  pull_request:
    branches: ["main"]
    tags:
      - "v*.*.*"

env:
  SOLUTION_FILE_PATH: .

  BUILD_CONFIGURATION: Release

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v4

      - name: Add MSBuild to PATH
        uses: microsoft/setup-msbuild@v1.0.2

      - name: Restore NuGet packages
        working-directory: ${{env.GITHUB_WORKSPACE}}
        run: nuget restore ${{env.SOLUTION_FILE_PATH}}

      - name: Build
        working-directory: ${{env.GITHUB_WORKSPACE}}
        run: msbuild /m /p:Configuration=${{env.BUILD_CONFIGURATION}} ${{env.SOLUTION_FILE_PATH}}

      - name: Rename
        run: mv .\x64\Release\*.exe ${{github.event.repository.name}}-${{github.ref_name}}.exe

      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          files: ${{github.event.repository.name}}-${{github.ref_name}}.exe
```

# ãŠã‚ã‚Šã«

GitHub Actions ã‚’ä½¿ã„ã“ãªã›ã‚‹ã‚ˆã†ã«ãªã‚ŠãŸã„ã¨ã„ã†æ°—æŒã¡ãŒã¡ã‚‡ã£ã¨å¤§ãããªã‚Šã¾ã—ãŸã€‚ã“ã†ã—ãŸã»ã†ãŒã„ã„ã¨ã‹ã‚ã‚Œã°æ•™ãˆã¦ä¸‹ã•ã„ï¼
